<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì½˜í…ì¸  ê°¤ëŸ¬ë¦¬ ë° ë·°ì–´ (ì™¸ë¶€ Manifest ë¡œë”©)</title>
    <!-- Tailwind CSS ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans KR', 'sans-serif'],
                    },
                    colors: {
                        'primary-blue': '#1D4ED8',
                        'secondary-gray': '#F3F4F6',
                    }
                }
            }
        }
    </script>
    <style>
        /* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
        #content-list {
            max-height: calc(100vh - 4rem); /* í—¤ë” ë†’ì´ë¥¼ ì œì™¸ */
            overflow-y: auto;
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        #content-list::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans min-h-screen flex flex-col">

<!-- í—¤ë” -->
<header class="bg-white shadow-md p-4 sticky top-0 z-10">
    <h1 class="text-2xl font-bold text-primary-blue">
        ğŸ“¦ ì½˜í…ì¸  ê°¤ëŸ¬ë¦¬ ë° ë·°ì–´ (ì™¸ë¶€ Manifest ë¡œë”©)
    </h1>
    <p class="text-sm text-gray-500 mt-1">
        ì™¼ìª½ ëª©ë¡ì—ì„œ í•­ëª©ì„ ì„ íƒí•˜ë©´ ì½˜í…ì¸ ê°€ ë¡œë“œë©ë‹ˆë‹¤.
    </p>
</header>

<!-- ë©”ì¸ ë ˆì´ì•„ì›ƒ (ë°˜ì‘í˜• 2ë‹¨ ê·¸ë¦¬ë“œ) -->
<main class="flex flex-1 overflow-hidden">

    <!-- 1. ì½˜í…ì¸  ëª©ë¡ ì„¹ì…˜ (ì‚¬ì´ë“œë°”) -->
    <aside id="content-list" class="w-full md:w-1/4 bg-secondary-gray border-r border-gray-200 p-4 flex-shrink-0">

        <!-- ê¸€ ì„¹ì…˜ ì»¨í…Œì´ë„ˆ -->
        <h2 class="text-lg font-semibold mb-3 mt-1 text-gray-700 border-b pb-2 flex items-center">
            <span class="text-xl mr-2">ğŸ“</span> ê¸€ ì„¹ì…˜
        </h2>
        <ul id="text-list-container" class="space-y-2 mb-6">
            <!-- JSë¡œ ê¸€ ëª©ë¡ ì±„ìš°ê¸° -->
        </ul>

        <!-- ì´ë¯¸ì§€ ì„¹ì…˜ ì»¨í…Œì´ë„ˆ -->
        <h2 class="text-lg font-semibold mb-3 mt-6 text-gray-700 border-b pb-2 flex items-center">
            <span class="text-xl mr-2">ğŸ–¼ï¸</span> ì´ë¯¸ì§€ ì„¹ì…˜
        </h2>
        <ul id="image-list-container" class="space-y-2">
            <!-- JSë¡œ ì´ë¯¸ì§€ ëª©ë¡ ì±„ìš°ê¸° -->
        </ul>

        <!-- ë¡œë”© ë©”ì‹œì§€ë¥¼ ëª©ë¡ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ë¡œ ì´ë™í•˜ì—¬ ë¡œë”© ìƒíƒœë¥¼ í‘œì‹œ -->
        <div id="sidebar-loading-message" class="text-center p-4">
            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-primary-blue mx-auto"></div>
            <p class="text-sm text-primary-blue mt-2">ì½˜í…ì¸  ëª©ë¡ ë¡œë”© ì¤‘...</p>
        </div>

        <!-- ë©”ì¸ ë·°ì–´ ë¡œë”© ë©”ì‹œì§€ (ê¸°ì¡´ ìœ„ì¹˜ ìœ ì§€) -->
        <div id="loading-message" class="text-center p-4 hidden">
            <!-- ì´ ë©”ì‹œì§€ëŠ” ì½˜í…ì¸  ë¡œë”© ì‹œì—ë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤. -->
        </div>
    </aside>

    <!-- 2. ì½˜í…ì¸  ë·°ì–´ ì„¹ì…˜ (ë©”ì¸ ì˜ì—­) -->
    <section id="content-viewer" class="flex-1 p-6 overflow-y-auto bg-white">
        <div id="viewer-container" class="max-w-4xl mx-auto">
            <h2 class="text-xl font-bold mb-4 text-gray-700">ì½˜í…ì¸ ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”</h2>
            <p class="text-gray-500">
                ì™¼ìª½ ëª©ë¡ì—ì„œ ë³´ê³  ì‹¶ì€ ê¸€ì´ë‚˜ ì´ë¯¸ì§€ë¥¼ í´ë¦­í•˜ì„¸ìš”.
            </p>
        </div>

        <!-- ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ -->
        <div id="error-box" class="hidden mt-8 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative">
            <strong class="font-bold">âš ï¸ ì˜¤ë¥˜ ë°œìƒ:</strong>
            <span class="block sm:inline" id="error-message"></span>
        </div>
    </section>

</main>

<script>
    // === ë™ì  ë¡œë”©ì„ ìœ„í•œ ì„¤ì •: ì™¸ë¶€ JSON íŒŒì¼ ê²½ë¡œ ===
    // ì‚¬ìš©ìê°€ ì—…ë°ì´íŠ¸í•  ëª©ë¡ íŒŒì¼ ê²½ë¡œì…ë‹ˆë‹¤.
    const API_URL = '/content_manifest.json';

    // í˜„ì¬ ë¡œë“œëœ ì½˜í…ì¸  ëª©ë¡ì„ ì €ì¥í•  ë³€ìˆ˜
    let contents = [];

    // DOM ìš”ì†Œ ì°¸ì¡°
    const textListContainer = document.getElementById('text-list-container');
    const imageListContainer = document.getElementById('image-list-container');
    const viewerContainer = document.getElementById('viewer-container');
    const errorBox = document.getElementById('error-box');
    const errorMessage = document.getElementById('error-message');
    const loadingMessage = document.getElementById('loading-message');
    const sidebarLoadingMessage = document.getElementById('sidebar-loading-message');

    /**
     * @description ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
     * @param {string} msg - í‘œì‹œí•  ì˜¤ë¥˜ ë©”ì‹œì§€
     */
    function showError(msg) {
        errorBox.classList.remove('hidden');
        errorMessage.textContent = msg;
        loadingMessage.classList.add('hidden');
    }

    /**
     * @description ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ìˆ¨ê¹ë‹ˆë‹¤.
     */
    function hideError() {
        errorBox.classList.add('hidden');
    }

    /**
     * @description ë©”ì¸ ë·°ì–´ì˜ ë¡œë”© ìƒíƒœë¥¼ í† ê¸€í•©ë‹ˆë‹¤.
     * @param {boolean} isLoading - ë¡œë”© ìƒíƒœ ì—¬ë¶€
     */
    function toggleLoading(isLoading) {
        if (isLoading) {
            viewerContainer.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì‚­ì œ
            loadingMessage.classList.remove('hidden');
        } else {
            loadingMessage.classList.add('hidden');
        }
    }

    /**
     * @description ì™¸ë¶€ JSON íŒŒì¼ë¡œë¶€í„° ì½˜í…ì¸  ëª©ë¡ì„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.
     */
    async function fetchContents() {
        sidebarLoadingMessage.classList.remove('hidden');

        try {
            console.log('Fetching manifest from:', API_URL); // ë””ë²„ê¹… ë¡œê·¸ 1: ë¡œë“œ ì‹œì‘
            // ì™¸ë¶€ JSON íŒŒì¼ fetch ì‹œë„
            const response = await fetch(API_URL);

            if (!response.ok) {
                throw new Error(`ëª©ë¡ íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨: ${response.status} ${response.statusText}. CORS/ê²½ë¡œ í™•ì¸ í•„ìš”.`);
            }

            // JSON íŒŒì‹±
            contents = await response.json();

            console.log('Manifest loaded successfully. Item count:', contents.length); // ë””ë²„ê¹… ë¡œê·¸ 2: ì„±ê³µ ë° í•­ëª© ìˆ˜ í™•ì¸

            if (!Array.isArray(contents)) {
                throw new Error("ì½˜í…ì¸  Manifest íŒŒì¼ì˜ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. JSON ë°°ì—´ì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
            }

        } catch (error) {
            console.error("ì½˜í…ì¸  ëª©ë¡ ë¡œë”© ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
            // ì‚¬ì´ë“œë°”ì— ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
            textListContainer.innerHTML = `<li class="text-red-500 text-sm">ëª©ë¡ ë¡œë”© ì‹¤íŒ¨: ${error.message}</li>`;
            imageListContainer.innerHTML = '';
        } finally {
            sidebarLoadingMessage.classList.add('hidden');
        }
    }

    /**
     * @description ì½˜í…ì¸  ëª©ë¡ì„ ì‚¬ì´ë“œë°”ì— ë Œë”ë§í•©ë‹ˆë‹¤.
     */
    function renderList() {
        textListContainer.innerHTML = ''; // ê¸€ ëª©ë¡ ì´ˆê¸°í™”
        imageListContainer.innerHTML = ''; // ì´ë¯¸ì§€ ëª©ë¡ ì´ˆê¸°í™”

        const textItems = contents.filter(item => item.type === 'text');
        const imageItems = contents.filter(item => item.type === 'image');

        // ê¸€ ì„¹ì…˜ ë Œë”ë§
        if (textItems.length > 0) {
            textItems.forEach(item => { appendListItem(item, textListContainer); });
        } else {
            textListContainer.innerHTML = `<li class="text-gray-500 text-sm">í‘œì‹œí•  ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</li>`;
        }

        // ì´ë¯¸ì§€ ì„¹ì…˜ ë Œë”ë§
        if (imageItems.length > 0) {
            imageItems.forEach(item => { appendListItem(item, imageListContainer); });
        } else {
            imageListContainer.innerHTML = `<li class="text-gray-500 text-sm">í‘œì‹œí•  ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</li>`;
        }
    }

    /**
     * @description ë‹¨ì¼ ëª©ë¡ í•­ëª©ì„ ìƒì„±í•˜ê³  ì»¨í…Œì´ë„ˆì— ì¶”ê°€í•©ë‹ˆë‹¤.
     * @param {object} item - ì½˜í…ì¸  í•­ëª© ê°ì²´
     * @param {HTMLElement} container - í•­ëª©ì„ ì¶”ê°€í•  <ul> ì»¨í…Œì´ë„ˆ
     */
    function appendListItem(item, container) {
        const li = document.createElement('li');
        const button = document.createElement('button');

        // í•­ëª© íƒ€ì…ì— ë”°ë¥¸ ì•„ì´ì½˜ ì„¤ì •
        const icon = item.type === 'text'
            ? '<span class="mr-2 text-primary-blue">ğŸ“–</span>'
            : '<span class="mr-2 text-primary-blue">ğŸ“·</span>';

        button.className = 'w-full text-left p-3 rounded-lg hover:bg-white transition duration-200 flex items-center shadow-sm';
        button.innerHTML = `${icon} <span class="truncate">${item.title}</span>`;

        // í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        button.onclick = (e) => loadContent(item, e.currentTarget);

        li.appendChild(button);
        container.appendChild(li);
    }

    /**
     * @description íŒŒì¼ ê²½ë¡œì—ì„œ íŒŒì¼ í™•ì¥ìë¥¼ ì¶”ì¶œí•˜ì—¬ íƒ€ì…ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
     * @param {string} path - íŒŒì¼ ê²½ë¡œ
     * @returns {string} - íŒŒì¼ í™•ì¥ì (ì˜ˆ: 'md', 'txt', 'jpg')
     */
    function getFileExtension(path) {
        return path.split('.').pop();
    }


    /**
     * @description API ê²½ë¡œì—ì„œ ì½˜í…ì¸ ë¥¼ ê°€ì ¸ì™€ ë·°ì–´ì— í‘œì‹œí•©ë‹ˆë‹¤.
     * @param {object} item - Manifestì— ì •ì˜ëœ ì½˜í…ì¸  í•­ëª© ê°ì²´
     * @param {HTMLElement} clickedButton - í˜„ì¬ í´ë¦­ëœ ë²„íŠ¼ ìš”ì†Œ
     */
    async function loadContent(item, clickedButton) {
        // ëª¨ë“  ëª©ë¡ ë²„íŠ¼ì—ì„œ active ìŠ¤íƒ€ì¼ ì œê±°
        document.querySelectorAll('#content-list button').forEach(btn => {
            btn.classList.remove('bg-white', 'font-bold', 'text-primary-blue', 'ring-2', 'ring-primary-blue');
        });

        // í˜„ì¬ í´ë¦­ëœ ë²„íŠ¼ì— active ìŠ¤íƒ€ì¼ ì¶”ê°€
        clickedButton.classList.add('bg-white', 'font-bold', 'text-primary-blue', 'ring-2', 'ring-primary-blue');

        hideError();
        toggleLoading(true);

        try {
            // ì´ë¯¸ì§€ê°€ placeholder ì„¤ì •ë˜ì–´ ìˆì„ ê²½ìš°, ì‹¤ì œ fetch ëŒ€ì‹  placeholder ì´ë¯¸ì§€ ì‚¬ìš©
            if (item.type === 'image' && item.placeholder) {
                const imageUrl = `https://placehold.co/${item.placeholder}`;
                viewerContainer.innerHTML = `
                        <div class="bg-white p-4 rounded-xl shadow-lg border border-gray-200">
                            <h3 class="text-2xl font-bold mb-4 text-gray-800">${item.title}</h3>
                            <div class="relative w-full overflow-hidden rounded-xl bg-gray-50 p-2">
                                <img src="${imageUrl}" alt="${item.title}" class="w-full h-auto object-cover rounded-lg" onerror="this.onerror=null;this.src='https://placehold.co/800x600/cccccc/000000?text=Image+Load+Failed';" />
                            </div>
                            <p class="mt-4 text-gray-600 text-sm">
                                ì´ë¯¸ì§€ íƒ€ì…: <strong>JPG/PNG (í”Œë ˆì´ìŠ¤í™€ë”)</strong> |
                                ì›ë³¸ ê²½ë¡œ: <code>${item.path}</code>
                            </p>
                        </div>
                    `;
                toggleLoading(false);
                return;
            }

            // í…ìŠ¤íŠ¸ ì½˜í…ì¸  ë˜ëŠ” ì‹¤ì œ ì´ë¯¸ì§€ ê²½ë¡œ fetch ì‹œë„
            const response = await fetch(item.path);

            if (!response.ok) {
                throw new Error(`íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ê²½ë¡œ: ${item.path}, ìƒíƒœ ì½”ë“œ: ${response.status})`);
            }

            if (item.type === 'text') {
                // í…ìŠ¤íŠ¸ ì½˜í…ì¸  (ê¸€)
                const textContent = await response.text();
                const fileExtension = getFileExtension(item.path).toUpperCase();

                viewerContainer.innerHTML = `
                        <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                            <h3 class="text-3xl font-extrabold mb-6 text-primary-blue border-b pb-3">${item.title}</h3>

                            <div class="mb-4 text-gray-600 text-sm">
                                íŒŒì¼ íƒ€ì…: <strong class="uppercase">${fileExtension}</strong> |
                                ê²½ë¡œ: <code>${item.path}</code>
                            </div>

                            <pre class="whitespace-pre-wrap font-mono p-4 bg-secondary-gray rounded-lg text-sm leading-relaxed border border-gray-200">
                                ${textContent}
                            </pre>
                        </div>
                    `;
            } else if (item.type === 'image') {
                // ì´ë¯¸ì§€ ì½˜í…ì¸ 
                const imageUrl = item.path;
                const fileExtension = getFileExtension(item.path).toUpperCase();

                viewerContainer.innerHTML = `
                        <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                            <h3 class="text-2xl font-bold mb-4 text-gray-800">${item.title}</h3>
                            <div class="relative w-full overflow-hidden rounded-xl bg-gray-50 p-2">
                                <img src="${imageUrl}" alt="${item.title}" class="w-full h-auto object-contain max-h-[70vh] rounded-lg mx-auto" onerror="this.onerror=null;this.src='https://placehold.co/800x600/cccccc/000000?text=Image+Load+Failed';" />
                            </div>
                            <p class="mt-4 text-gray-600 text-sm">
                                íŒŒì¼ íƒ€ì…: <strong class="uppercase">${fileExtension}</strong> |
                                ì´ë¯¸ì§€ ê²½ë¡œ: <code>${item.path}</code>
                            </p>
                        </div>
                    `;
            }
        } catch (error) {
            console.error("ì½˜í…ì¸  ë¡œë”© ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
            showError(`ì½˜í…ì¸  ë¡œë”© ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            // ì—ëŸ¬ ë°œìƒ ì‹œ ë·°ì–´ ì»¨í…Œì´ë„ˆì— ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
            viewerContainer.innerHTML = `
                    <p class="text-red-500 font-medium">ì½˜í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì„œë²„ì— íŒŒì¼(ê²½ë¡œ: ${item.path})ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ê±°ë‚˜, ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì˜¤ë¥˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
                `;

        } finally {
            toggleLoading(false);
        }
    }

    // ì´ˆê¸°í™” í•¨ìˆ˜
    async function initializeApp() {
        // 1. ì™¸ë¶€ JSON íŒŒì¼ì—ì„œ ì½˜í…ì¸  ëª©ë¡ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
        await fetchContents();

        // 2. ëª©ë¡ì„ ë Œë”ë§í•©ë‹ˆë‹¤.
        renderList();

        // 3. ì²« ë²ˆì§¸ í•­ëª©ì„ ìë™ìœ¼ë¡œ ë¡œë“œí•©ë‹ˆë‹¤.
        const firstButton = textListContainer.querySelector('button') || imageListContainer.querySelector('button');
        if (firstButton) {
            // DOMì´ ë¡œë“œëœ í›„ ì²« ë²ˆì§¸ ë²„íŠ¼ì— í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ê°•ì œ ì‹¤í–‰
            setTimeout(() => {
                firstButton.click();
            }, 100);
        } else {
            viewerContainer.innerHTML = '<p class="text-gray-500">í‘œì‹œí•  ì½˜í…ì¸  ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤. Manifest íŒŒì¼ê³¼ ê·¸ ë‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</p>';
        }
    }

    // ì´ˆê¸°í™” ì‹œì‘
    window.onload = initializeApp;

</script>
</body>
</html>
