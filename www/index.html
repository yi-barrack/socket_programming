<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì½˜í…ì¸  ê°¤ëŸ¬ë¦¬ ë° ë·°ì–´ (ì™¸ë¶€ Manifest ë¡œë”©)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans KR', 'sans-serif'],
                    },
                    colors: {
                        'primary-blue': '#1D4ED8',
                        'secondary-gray': '#F3F4F6',
                    }
                }
            }
        }
    </script>
    <style>
        /* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
        #content-list {
            max-height: calc(100vh - 4rem); /* í—¤ë” ë†’ì´ë¥¼ ì œì™¸ */
            overflow-y: auto;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        #content-list::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans min-h-screen flex flex-col">

<header class="bg-white shadow-md p-4 sticky top-0 z-10">
    <h1 class="text-2xl font-bold text-primary-blue">
        ğŸ“¦ ì½˜í…ì¸  ê°¤ëŸ¬ë¦¬ ë° ë·°ì–´
    </h1>
    <p class="text-sm text-gray-500 mt-1">
        ì™¼ìª½ ëª©ë¡ì—ì„œ í•­ëª©ì„ ì„ íƒí•˜ë©´ ì½˜í…ì¸ ê°€ ë¡œë“œë©ë‹ˆë‹¤.
    </p>
</header>

<main class="flex flex-1 overflow-hidden">

    <aside id="content-list" class="w-full md:w-1/4 bg-secondary-gray border-r border-gray-200 p-4 flex-shrink-0">

        <button onclick="showPostModal()"
                class="w-full bg-primary-blue hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 mb-4 shadow-md flex items-center justify-center">
            <span class="text-xl mr-2">+</span> ê¸€ ì¶”ê°€í•˜ê¸°
        </button>

        <h2 class="text-lg font-semibold mb-3 mt-1 text-gray-700 border-b pb-2 flex items-center">
            <span class="text-xl mr-2">ğŸ“</span> ê¸€ ì„¹ì…˜
        </h2>
        <ul id="text-list-container" class="space-y-2 mb-6">
        </ul>

        <h2 class="text-lg font-semibold mb-3 mt-6 text-gray-700 border-b pb-2 flex items-center">
            <span class="text-xl mr-2">ğŸ–¼ï¸</span> ì´ë¯¸ì§€ ì„¹ì…˜
        </h2>
        <ul id="image-list-container" class="space-y-2">
        </ul>

        <div id="sidebar-loading-message" class="text-center p-4">
            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-primary-blue mx-auto"></div>
            <p class="text-sm text-primary-blue mt-2">ì½˜í…ì¸  ëª©ë¡ ë¡œë”© ì¤‘...</p>
        </div>

        <div id="loading-message" class="text-center p-4 hidden">
        </div>
    </aside>

    <section id="content-viewer" class="flex-1 p-6 overflow-y-auto bg-white">
        <div id="viewer-container" class="max-w-4xl mx-auto">
            <h2 class="text-xl font-bold mb-4 text-gray-700">ì½˜í…ì¸ ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”</h2>
            <p class="text-gray-500">
                ì™¼ìª½ ëª©ë¡ì—ì„œ ë³´ê³  ì‹¶ì€ ê¸€ì´ë‚˜ ì´ë¯¸ì§€ë¥¼ í´ë¦­í•˜ì„¸ìš”.
            </p>
        </div>

        <div id="error-box" class="hidden mt-8 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative">
            <strong class="font-bold">âš ï¸ ì˜¤ë¥˜ ë°œìƒ:</strong>
            <span class="block sm:inline" id="error-message"></span>
        </div>
    </section>

</main>

<div id="confirm-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-sm p-6 m-4 relative">
        <h3 class="text-xl font-bold mb-4 text-red-600 border-b pb-2">âš ï¸ ì‚­ì œ í™•ì¸</h3>
        <p id="confirm-message" class="mb-6 text-gray-700">ì •ë§ë¡œ "<span id="delete-item-title" class="font-semibold"></span>" í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>

        <div class="flex justify-end space-x-3">
            <button id="cancel-delete-button" type="button"
                    class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition duration-150">
                ì·¨ì†Œ
            </button>
            <button id="execute-delete-button" type="button"
                    class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 transition duration-150">
                ì˜êµ¬ ì‚­ì œ
            </button>
        </div>
    </div>
</div>
<div id="post-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-lg p-6 m-4 relative">

        <h3 class="text-2xl font-bold mb-4 text-primary-blue border-b pb-2">ğŸ“ ìƒˆ ê¸€ ì‘ì„±í•˜ê¸°</h3>

        <form id="post-form" onsubmit="event.preventDefault(); submitPost();">
            <div class="mb-4">
                <label for="post-title" class="block text-sm font-medium text-gray-700 mb-1">ì œëª©</label>
                <input type="text" id="post-title" required
                       class="w-full p-2 border border-gray-300 rounded-lg focus:ring-primary-blue focus:border-primary-blue transition duration-150">
            </div>
            <div class="mb-6">
                <label for="post-content" class="block text-sm font-medium text-gray-700 mb-1">ê¸€ ë‚´ìš©</label>
                <textarea id="post-content" rows="8" required
                          class="w-full p-2 border border-gray-300 rounded-lg focus:ring-primary-blue focus:border-primary-blue transition duration-150"></textarea>
            </div>

            <div class="flex justify-end space-x-3">
                <button type="button" onclick="hidePostModal()"
                        class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition duration-150">
                    ì·¨ì†Œ
                </button>
                <button type="submit" id="submit-button"
                        class="px-4 py-2 text-sm font-medium text-white bg-primary-blue rounded-lg hover:bg-blue-700 transition duration-150">
                    ì‘ì„± ì™„ë£Œ ë° ì €ì¥
                </button>
            </div>

            <div id="post-message" class="mt-4 p-3 text-sm rounded-lg hidden"></div>
        </form>

        <button onclick="hidePostModal()" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
    </div>
</div>
<script>
    // === í™˜ê²½ ì„¤ì • ===
    const API_MANIFEST_URL = '/content_manifest.json';
    const API_POST_URL = '/api/posts'; // ì„œë²„ì˜ PostCreationHandlerë¡œ ìš”ì²­ì„ ë³´ë‚¼ ì—”ë“œí¬ì¸íŠ¸ (POST)
    const API_DELETE_URL = '/api/posts'; // ì„œë²„ì˜ ì‚­ì œ ì—”ë“œí¬ì¸íŠ¸ (DELETE)

    let contents = [];
    let currentDeleteId = null; // ğŸ’¡ í˜„ì¬ ì‚­ì œ ëŒ€ê¸° ì¤‘ì¸ í•­ëª©ì˜ IDë¥¼ ì €ì¥í•˜ëŠ” ì „ì—­ ë³€ìˆ˜

    // DOM ìš”ì†Œ ì°¸ì¡°
    const textListContainer = document.getElementById('text-list-container');
    const imageListContainer = document.getElementById('image-list-container');
    const viewerContainer = document.getElementById('viewer-container');
    const errorBox = document.getElementById('error-box');
    const errorMessage = document.getElementById('error-message');
    const loadingMessage = document.getElementById('loading-message');
    const sidebarLoadingMessage = document.getElementById('sidebar-loading-message');

    // ëª¨ë‹¬ ê´€ë ¨ DOM ì°¸ì¡°
    const postModal = document.getElementById('post-modal');
    const postForm = document.getElementById('post-form');
    const postTitleInput = document.getElementById('post-title');
    const postContentTextarea = document.getElementById('post-content');
    const postMessageDiv = document.getElementById('post-message');
    const submitButton = document.getElementById('submit-button');

    // ì‚­ì œ ëª¨ë‹¬ ê´€ë ¨ DOM ì°¸ì¡°
    const confirmModal = document.getElementById('confirm-modal');
    const deleteItemTitleSpan = document.getElementById('delete-item-title');
    const executeDeleteButton = document.getElementById('execute-delete-button');
    const cancelDeleteButton = document.getElementById('cancel-delete-button');


    // =========================================================================
    // === ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ===
    // =========================================================================

    /**
     * @description ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
     */
    function showError(msg) {
        errorBox.classList.remove('hidden');
        errorMessage.textContent = msg;
        loadingMessage.classList.add('hidden');
    }

    /**
     * @description ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ìˆ¨ê¹ë‹ˆë‹¤.
     */
    function hideError() {
        errorBox.classList.add('hidden');
    }

    /**
     * @description íŒŒì¼ ê²½ë¡œì—ì„œ íŒŒì¼ í™•ì¥ìë¥¼ ì¶”ì¶œí•˜ì—¬ íƒ€ì…ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
     */
    function getFileExtension(path) {
        return path.split('.').pop();
    }


    // =========================================================================
    // === ëª©ë¡ ë¡œë”© ë° ë Œë”ë§ í•¨ìˆ˜ ===
    // =========================================================================

    /**
     * @description ì™¸ë¶€ JSON íŒŒì¼ë¡œë¶€í„° ì½˜í…ì¸  ëª©ë¡ì„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.
     */
    async function fetchContents() {
        sidebarLoadingMessage.classList.remove('hidden');

        try {
            // ì™¸ë¶€ JSON íŒŒì¼ fetch ì‹œë„
            const response = await fetch(API_MANIFEST_URL);

            if (!response.ok) {
                throw new Error(`ëª©ë¡ íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨: ${response.status} ${response.statusText}`);
            }

            contents = await response.json();

            if (!Array.isArray(contents)) {
                throw new Error("ì½˜í…ì¸  Manifest íŒŒì¼ì˜ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. JSON ë°°ì—´ì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
            }

        } catch (error) {
            console.error("ì½˜í…ì¸  ëª©ë¡ ë¡œë”© ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
            textListContainer.innerHTML = `<li class="text-red-500 text-sm">ëª©ë¡ ë¡œë”© ì‹¤íŒ¨: ${error.message}</li>`;
            imageListContainer.innerHTML = '';
        } finally {
            sidebarLoadingMessage.classList.add('hidden');
        }
    }

    /**
     * @description ì½˜í…ì¸  ëª©ë¡ì„ ì‚¬ì´ë“œë°”ì— ë Œë”ë§í•©ë‹ˆë‹¤.
     */
    function renderList() {
        textListContainer.innerHTML = '';
        imageListContainer.innerHTML = '';

        const textItems = contents.filter(item => item.type === 'text');
        const imageItems = contents.filter(item => item.type === 'image');

        if (textItems.length > 0) {
            textItems.forEach(item => { appendListItem(item, textListContainer); });
        } else {
            textListContainer.innerHTML = `<li class="text-gray-500 text-sm p-3">í‘œì‹œí•  ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</li>`;
        }

        if (imageItems.length > 0) {
            imageItems.forEach(item => { appendListItem(item, imageListContainer); });
        } else {
            imageListContainer.innerHTML = `<li class="text-gray-500 text-sm p-3">í‘œì‹œí•  ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</li>`;
        }
    }

    /**
     * @description ë‹¨ì¼ ëª©ë¡ í•­ëª©ì„ ìƒì„±í•˜ê³  ì»¨í…Œì´ë„ˆì— ì¶”ê°€í•©ë‹ˆë‹¤.
     */
    function appendListItem(item, container) {
        const li = document.createElement('li');
        li.className = 'group relative'; // ë§ˆìš°ìŠ¤ ì˜¤ë²„ ê°ì§€ë¥¼ ìœ„í•œ group í´ë˜ìŠ¤ ì¶”ê°€

        // ì½˜í…ì¸  ë¡œë”© ë²„íŠ¼
        const button = document.createElement('button');
        const icon = item.type === 'text'
            ? '<span class="mr-2 text-primary-blue">ğŸ“–</span>'
            : '<span class="mr-2 text-primary-blue">ğŸ“·</span>';

        button.className = 'w-full text-left p-3 rounded-lg hover:bg-white transition duration-200 flex items-center shadow-sm';
        button.innerHTML = `${icon} <span class="truncate pr-10">${item.title}</span>`;

        button.onclick = (e) => loadContent(item, e.currentTarget);

        li.appendChild(button);

        // í…ìŠ¤íŠ¸ íƒ€ì…ì¸ ê²½ìš°ì—ë§Œ ì‚­ì œ ë²„íŠ¼ ì¶”ê°€
        if (item.type === 'text') {
            const deleteBtn = document.createElement('button');
            // íœ´ì§€í†µ ì•„ì´ì½˜ (Lucide Icon SVG ì‚¬ìš©)
            deleteBtn.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                `;
            deleteBtn.className = 'absolute right-2 top-1/2 transform -translate-y-1/2 p-2 text-red-500 hover:text-red-700 transition duration-150 rounded-full bg-secondary-gray/50 hidden group-hover:block z-10';

            deleteBtn.onclick = (e) => {
                e.stopPropagation(); // ëª©ë¡ í´ë¦­ ì´ë²¤íŠ¸ ë°©ì§€
                confirmAndDeletePost(item);
            };

            li.appendChild(deleteBtn);
        }

        container.appendChild(li);
    }

    // =========================================================================
    // === ì½˜í…ì¸  ë·°ì–´ í•¨ìˆ˜ ===
    // =========================================================================

    /**
     * @description ë©”ì¸ ë·°ì–´ì˜ ë¡œë”© ìƒíƒœë¥¼ í† ê¸€í•©ë‹ˆë‹¤.
     */
    function toggleLoading(isLoading) {
        if (isLoading) {
            viewerContainer.innerHTML = '';
            loadingMessage.classList.remove('hidden');
        } else {
            loadingMessage.classList.add('hidden');
        }
    }

    /**
     * @description API ê²½ë¡œì—ì„œ ì½˜í…ì¸ ë¥¼ ê°€ì ¸ì™€ ë·°ì–´ì— í‘œì‹œí•©ë‹ˆë‹¤.
     */
    async function loadContent(item, clickedButton) {
        document.querySelectorAll('#content-list button').forEach(btn => {
            // delete buttonì´ ì•„ë‹Œ load content buttonë§Œ ì²˜ë¦¬
            if (!btn.classList.contains('text-red-500')) {
                btn.classList.remove('bg-white', 'font-bold', 'text-primary-blue', 'ring-2', 'ring-primary-blue');
            }
        });
        // delete buttonì— ëŒ€í•œ ìŠ¤íƒ€ì¼ì´ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ì£¼ì˜
        if (!clickedButton.classList.contains('text-red-500')) {
            clickedButton.classList.add('bg-white', 'font-bold', 'text-primary-blue', 'ring-2', 'ring-primary-blue');
        }


        hideError();
        toggleLoading(true);

        try {
            // --- ì´ë¯¸ì§€ ë¡œë“œ ë¡œì§ (í”Œë ˆì´ìŠ¤í™€ë” ë° ì‹¤ì œ íŒŒì¼) ---
            if (item.type === 'image') {
                const fileExtension = getFileExtension(item.path).toUpperCase();
                let imageUrl = item.path;

                if (item.placeholder) { // í”Œë ˆì´ìŠ¤í™€ë” ì‚¬ìš©
                    imageUrl = `https://placehold.co/${item.placeholder}`;
                    console.log('[Image Load] Using Placeholder:', imageUrl);
                } else { // ì‹¤ì œ íŒŒì¼ ë¡œë“œ ì‹œë„
                    console.log('[Image Load] Attempting to load actual file:', item.path);
                }

                // ì´ë¯¸ì§€ ë¡œë“œ ì‹œì—ëŠ” fetch ëŒ€ì‹  <img> íƒœê·¸ ìì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¸Œë¼ìš°ì €ê°€ ë¡œë“œë¥¼ ë‹´ë‹¹í•˜ê²Œ í•©ë‹ˆë‹¤.
                // ëŒ€ì‹ , ë¡œë“œì— ì‹¤íŒ¨í•˜ë©´ onerror ì´ë²¤íŠ¸ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

                viewerContainer.innerHTML = `
                        <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                            <h3 class="text-2xl font-bold mb-4 text-gray-800">${item.title}</h3>
                            <div class="relative w-full overflow-hidden rounded-xl bg-gray-50 p-2">
                                <img src="${imageUrl}" alt="${item.title}"
                                     class="w-full h-auto object-contain max-h-[70vh] rounded-lg mx-auto"
                                     onerror="handleImageLoadError(this, '${item.path}')" />
                            </div>
                            <p class="mt-4 text-gray-600 text-sm">
                                ID: <strong class="font-bold text-gray-800">${item.id}</strong> |
                                íŒŒì¼ íƒ€ì…: <strong class="uppercase">${fileExtension}</strong> |
                                ì´ë¯¸ì§€ ê²½ë¡œ: <code>${item.path}</code>
                            </p>
                        </div>
                    `;
                toggleLoading(false);
                return;
            }

            // --- í…ìŠ¤íŠ¸ ì½˜í…ì¸  ë¡œë“œ ë¡œì§ ---
            const response = await fetch(item.path);

            if (!response.ok) {
                throw new Error(`íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ê²½ë¡œ: ${item.path}, ìƒíƒœ ì½”ë“œ: ${response.status})`);
            }

            if (item.type === 'text') {
                const textContent = await response.text();
                const fileExtension = getFileExtension(item.path).toUpperCase();

                viewerContainer.innerHTML = `
                        <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                            <h3 class="text-3xl font-extrabold mb-6 text-primary-blue border-b pb-3">${item.title}</h3>

                            <div class="mb-4 text-gray-600 text-sm">
                                ID: <strong class="font-bold text-gray-800">${item.id}</strong> |
                                íŒŒì¼ íƒ€ì…: <strong class="uppercase">${fileExtension}</strong> |
                                ê²½ë¡œ: <code>${item.path}</code>
                            </div>

                            <pre class="whitespace-pre-wrap font-mono p-4 bg-secondary-gray rounded-lg text-sm leading-relaxed border border-gray-200">
                                ${textContent}
                            </pre>
                        </div>
                    `;
            }
        } catch (error) {
            console.error("ì½˜í…ì¸  ë¡œë”© ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
            showError(`ì½˜í…ì¸  ë¡œë”© ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            viewerContainer.innerHTML = `<p class="text-red-500 font-medium">ì½˜í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì„œë²„ì— íŒŒì¼(ê²½ë¡œ: ${item.path})ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.</p>`;

        } finally {
            toggleLoading(false);
        }
    }

    /**
     * @description ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ ì‹œ í˜¸ì¶œë©ë‹ˆë‹¤.
     */
    function handleImageLoadError(imgElement, path) {
        imgElement.onerror = null; // ì¬í˜¸ì¶œ ë°©ì§€
        imgElement.src = 'https://placehold.co/800x600/cccccc/000000?text=Image+Load+Failed'; // ëŒ€ì²´ ì´ë¯¸ì§€ í‘œì‹œ

        // ì—ëŸ¬ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
        const parentP = imgElement.closest('.bg-white').querySelector('p.text-gray-600');
        if (parentP) {
            parentP.innerHTML = `
                     <span class="text-red-500 font-bold">âš ï¸ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:</span> ì„œë²„ ê²½ë¡œ <code>${path}</code>ì— íŒŒì¼ì´ ì—†ê±°ë‚˜ ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                 `;
        }
        console.error(`Failed to load image at: ${path}. Check server directory /images/.`);
    }


    // =========================================================================
    // === ê¸€ì“°ê¸° ëª¨ë‹¬ í•¨ìˆ˜ (POST) ===
    // =========================================================================

    /**
     * @description ê¸€ì“°ê¸° ëª¨ë‹¬ì„ í‘œì‹œí•˜ê³  í¼ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
     */
    function showPostModal() {
        postModal.classList.remove('hidden');
        postModal.classList.add('flex');
        postForm.reset(); // í¼ ë‚´ìš© ì´ˆê¸°í™”
        postMessageDiv.classList.add('hidden'); // ë©”ì‹œì§€ ìˆ¨ê¹€
        submitButton.disabled = false;
    }

    /**
     * @description ê¸€ì“°ê¸° ëª¨ë‹¬ì„ ìˆ¨ê¹ë‹ˆë‹¤.
     */
    function hidePostModal() {
        postModal.classList.add('hidden');
        postModal.classList.remove('flex');
    }

    /**
     * @description ì‘ì„±ëœ ê¸€ì„ ì„œë²„ë¡œ POST ìš”ì²­í•©ë‹ˆë‹¤.
     */
    async function submitPost() {
        const title = postTitleInput.value.trim();
        const content = postContentTextarea.value.trim();

        postMessageDiv.classList.add('hidden');
        submitButton.disabled = true;

        if (title === '' || content === '') {
            displayPostMessage('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.', 'bg-yellow-100 text-yellow-800');
            submitButton.disabled = false;
            return;
        }

        const payload = JSON.stringify({
            title: title,
            content: content
        });

        try {
            const response = await fetch(API_POST_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: payload
            });

            if (response.ok) {
                const responseText = await response.text();
                displayPostMessage(`âœ… ê¸€ ì‘ì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ì„œë²„ ì‘ë‹µ: ${responseText.substring(0, 50)}...`, 'bg-green-100 text-green-800');

                // ì„±ê³µ í›„ 3ì´ˆ ë’¤ ëª¨ë‹¬ ë‹«ê³  ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                setTimeout(() => {
                    hidePostModal();
                    initializeApp(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ë° ì²« í•­ëª© ë¡œë“œ
                }, 3000);

            } else {
                const errorBody = await response.text();
                throw new Error(`[${response.status}] ${response.statusText}. ì‘ë‹µ ë‚´ìš©: ${errorBody.substring(0, 100)}...`);
            }
        } catch (error) {
            console.error("POST ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
            displayPostMessage(`âŒ ê¸€ ì €ì¥ ì‹¤íŒ¨: ${error.message}`, 'bg-red-100 text-red-800');
        } finally {
            submitButton.disabled = false;
        }
    }

    /**
     * @description ëª¨ë‹¬ ë‚´ë¶€ì— ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
     */
    function displayPostMessage(message, className) {
        postMessageDiv.textContent = message;
        postMessageDiv.className = `mt-4 p-3 text-sm rounded-lg ${className}`;
        postMessageDiv.classList.remove('hidden');
    }

    // =========================================================================
    // === ì‚­ì œ í•¨ìˆ˜ (DELETE) ===
    // =========================================================================

    /**
     * @description ì‚­ì œ í™•ì¸ ëª¨ë‹¬ì„ í‘œì‹œí•˜ê³  ì‚­ì œí•  IDë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
     */
    function confirmAndDeletePost(item) {
        currentDeleteId = item.id; // ğŸ’¡ ì‚­ì œí•  IDë¥¼ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
        deleteItemTitleSpan.textContent = item.title;

        confirmModal.classList.remove('hidden');
        confirmModal.classList.add('flex');
    }

    /**
     * @description ì‚­ì œ í™•ì¸ ëª¨ë‹¬ì„ ìˆ¨ê¹ë‹ˆë‹¤.
     */
    function hideConfirmModal() {
        confirmModal.classList.add('hidden');
        confirmModal.classList.remove('flex');
        currentDeleteId = null; // ID ì´ˆê¸°í™”
    }

    /**
     * @description ì„œë²„ì— DELETE ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤. (ì „ì—­ ë³€ìˆ˜ currentDeleteId ì‚¬ìš©)
     */
    async function deletePost() {
        const idToDelete = currentDeleteId;
        if (!idToDelete) {
            showError('ì‚­ì œí•  í•­ëª©ì˜ IDê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.');
            return;
        }

        // ë·°ì–´ì™€ ëª©ë¡ì„ ë¡œë”© ìƒíƒœë¡œ ì „í™˜
        toggleLoading(true);
        hideError();

        try {
            // DELETE ìš”ì²­ì„ ë³´ë‚¼ ì—”ë“œí¬ì¸íŠ¸: /api/posts/{id}
            const response = await fetch(`${API_DELETE_URL}/${idToDelete}`, {
                method: 'DELETE',
            });

            if (response.ok) {
                // ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ë©´ ëª©ë¡ì„ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.
                console.log(`âœ… ê¸€ (ID: ${idToDelete})ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                // ì•Œë¦¼ ë©”ì‹œì§€ í‘œì‹œ (ì„ì‹œ)
                alert(`[ì‚­ì œ ì„±ê³µ] í•­ëª© ID ${idToDelete}ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                hideConfirmModal();
                // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                initializeApp();

            } else {
                const errorBody = await response.text();
                throw new Error(`[${response.status}] ${response.statusText}. ì„œë²„ ì‘ë‹µ: ${errorBody.substring(0, 100)}...`);
            }
        } catch (error) {
            console.error("DELETE ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
            showError(`ì‚­ì œ ì‹¤íŒ¨: ${error.message}`);
            toggleLoading(false);
        }
    }

    /**
     * @description ì‚­ì œ ëª¨ë‹¬ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ í•œ ë²ˆë§Œ ë°”ì¸ë”©í•©ë‹ˆë‹¤.
     */
    function bindDeleteModalListeners() {
        // executeDeleteButtonì€ í•­ìƒ deletePost() í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
        executeDeleteButton.addEventListener('click', deletePost);

        // cancelDeleteButtonì€ ëª¨ë‹¬ì„ ìˆ¨ê¹ë‹ˆë‹¤.
        cancelDeleteButton.addEventListener('click', hideConfirmModal);

        // ëª¨ë‹¬ ë‹«ê¸° ì´ë²¤íŠ¸(ë°°ê²½ í´ë¦­ ë“±)ë¥¼ ì²˜ë¦¬í•  í•„ìš”ëŠ” ì—†ìœ¼ë‚˜,
        // í˜„ì¬ëŠ” ë²„íŠ¼ ì´ë²¤íŠ¸ë§Œ ë°”ì¸ë”©í•©ë‹ˆë‹¤.
    }


    // =========================================================================
    // === ì´ˆê¸°í™” í•¨ìˆ˜ ===
    // =========================================================================

    async function initializeApp() {
        // ë¦¬ìŠ¤ë„ˆëŠ” ì•±ì´ ë¡œë“œë  ë•Œ í•œ ë²ˆë§Œ ë°”ì¸ë”©í•©ë‹ˆë‹¤. (ì¤‘ë³µ ë°©ì§€)
        if (!window.deleteListenersBound) {
            bindDeleteModalListeners();
            window.deleteListenersBound = true;
        }

        await fetchContents();
        renderList();

        // ì²« ë²ˆì§¸ ê¸€ í•­ëª©ì˜ IDë¥¼ ê°€ì ¸ì™€ì„œ ë·°ì–´ì— í‘œì‹œí•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.
        const firstButton = textListContainer.querySelector('button') || imageListContainer.querySelector('button');
        if (firstButton) {
            // DOMì´ ë Œë”ë§ ëœ í›„ í´ë¦­ì„ ìœ ë°œ
            setTimeout(() => {
                firstButton.click();
            }, 100);
        } else {
            viewerContainer.innerHTML = '<p class="text-gray-500">í‘œì‹œí•  ì½˜í…ì¸  ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤. Manifest íŒŒì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</p>';
            toggleLoading(false);
        }
    }

    window.onload = initializeApp;

</script>
</body>
</html>